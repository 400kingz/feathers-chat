<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0" />
    <title>FeathersJS chat</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="base.css">
    <link rel="stylesheet" href="chat.css">
  </head>
  <body>
    <div id="app" class="flex flex-column"></div>
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.js"></script>
    <script src="//unpkg.com/@feathersjs/client@^4.3.0/dist/feathers.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
      const client = feathers();

      // const socket = io('/', {
      //   extraHeaders: {
      //     'X-Next-Server-Key': 'supersecret'
      //   }
      // });
      // client.configure(feathers.socketio(socket));

      const rest = feathers.rest();
      
      client.configure(rest.fetch(fetch));
      client.configure(feathers.authentication());
      client.hooks({
        before: context => {
          const { headers = {} } = context.params;
          
          context.params.headers = {
            ...headers,
            'X-Next-Server-Key': 'supersecret'
          }
        }
      });

      (async () => {
        console.log(await client.service('users').find());
        console.log(await client.service('messages').find());
      })();
    </script>
  </body>
</html>
